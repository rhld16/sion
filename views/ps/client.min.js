var coin,players,rooms,canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),keys=[],input=!1;function gesize(){ctx.canvas.width=window.innerWidth,ctx.canvas.height=window.innerHeight}function drawPlayers(e){Object.keys(e).forEach(t=>{let a=e[t];ctx.fillStyle=a.colour,ctx.fillRect(a.x/5,a.y/5,playerSize/5,playerSize/5)})}function updateGameState(e){players=e.players,coins=e.coins,e.rooms&&(rooms=e.rooms),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.beginPath(),ctx.arc((coins.x+coinSize/2)/5,(coins.y+coinSize/2)/5,coinSize/5,0,2*Math.PI,!1),ctx.fillStyle="gold",ctx.fill(),ctx.lineWidth=2,ctx.strokeStyle="#003300",ctx.stroke()}function gameLoop(){(mainstage="game")&&(movePlayer(socket.id,keys),socket.emit("keys",keys),updateGameState({players:players,coins:coins}),Object.keys(players).forEach(e=>{let t=players[e];movePlayer(e,t.keys)}))}function nameLoop(){var e="",t="";$("#userslist").empty(),Object.values(players).sort((e,t)=>t.score-e.score).forEach((t,a)=>e+=`<li><span style='border-bottom: 1px solid ${t.colour};'>${t.name}</span> - ${t.score}</li>`),$("#userslist").append(e),rooms&&!input&&($("#roomlist").empty(),rooms.forEach(function(e){t+=`<li onclick="changeRoom('${e}')" style="cursor: pointer;">${e}</li>`}),t+='<li style="cursor: pointer;"><span data-editable><i class="fas fa-plus-circle"></i> Create Room</span></li>',$("#roomlist").append(t))}function drawGame(){drawPlayers(players),requestAnimationFrame(drawGame)}gesize(),document.body.addEventListener("keydown",e=>keys[e.keyCode]=!0),document.body.addEventListener("keyup",e=>keys[e.keyCode]=!1),$("body").on("click","[data-editable]",function(){input=!0;var e=$(this),t=$("<input />");e.replaceWith(t);t.one("blur",function(){var e=t.val(),a=$("<span data-editable />").text(e);changeRoom(e),t.replaceWith(a),input=!1}).focus(),t.keypress(function(e){13==e.which&&t.blur()})}),requestAnimationFrame(drawGame);